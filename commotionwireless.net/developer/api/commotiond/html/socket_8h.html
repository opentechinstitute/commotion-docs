---
layout: default
title: API Reference - commotiond
site_section: developers
categories: 
created: 2014-06-06 13:22:04.584366
changed: 2014-06-06 13:22:04.584366
post_author: Commotion
lang: en
---
<div id="doxygen">
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part --> 
<!-- Generated by Doxygen 1.8.7 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">socket.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>a simple object-oriented socket wrapper object model inspired by Zed Shaw  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;stddef.h&gt;</code><br />
<code>#include &lt;stdbool.h&gt;</code><br />
<code>#include &quot;<a class="el" href="obj_8h_source.html">obj.h</a>&quot;</code><br />
</div>
<p><a href="socket_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structco__fd__t.html">co_fd_t</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structco__socket__t.html">co_socket_t</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structunix__socket__t.html">unix_socket_t</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a210e5cdf7c5eddc1107da153dfe674ca"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a210e5cdf7c5eddc1107da153dfe674ca"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>MAX_IPPROTO</b>&#160;&#160;&#160;255</td></tr>
<tr class="separator:a210e5cdf7c5eddc1107da153dfe674ca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a053b7859476cc9867ec62c49e68d3fa1"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a053b7859476cc9867ec62c49e68d3fa1"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>MAX_CONNECTIONS</b>&#160;&#160;&#160;32</td></tr>
<tr class="separator:a053b7859476cc9867ec62c49e68d3fa1"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:a47b0f51346a3f52b9b5731331c5cc2d9"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a47b0f51346a3f52b9b5731331c5cc2d9"></a>
typedef struct <a class="el" href="structco__fd__t.html">co_fd_t</a>&#160;</td><td class="memItemRight" valign="bottom"><b>co_fd_t</b></td></tr>
<tr class="separator:a47b0f51346a3f52b9b5731331c5cc2d9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5143be538f0aef16f86e8be6be424490"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a5143be538f0aef16f86e8be6be424490"></a>
typedef struct <a class="el" href="structco__socket__t.html">co_socket_t</a>&#160;</td><td class="memItemRight" valign="bottom"><b>co_socket_t</b></td></tr>
<tr class="separator:a5143be538f0aef16f86e8be6be424490"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae0c99a2bc380b059ea1599ea70410693"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ae0c99a2bc380b059ea1599ea70410693"></a>
typedef struct <a class="el" href="structunix__socket__t.html">unix_socket_t</a>&#160;</td><td class="memItemRight" valign="bottom"><b>unix_socket_t</b></td></tr>
<tr class="separator:ae0c99a2bc380b059ea1599ea70410693"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ab2e5544e69816fead5d69bedddf46aaf"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structco__obj__t.html">co_obj_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="socket_8h.html#ab2e5544e69816fead5d69bedddf46aaf">co_fd_create</a> (<a class="el" href="structco__obj__t.html">co_obj_t</a> *parent, int fd)</td></tr>
<tr class="memdesc:ab2e5544e69816fead5d69bedddf46aaf"><td class="mdescLeft">&#160;</td><td class="mdescRight">creates a file descriptor object  <a href="#ab2e5544e69816fead5d69bedddf46aaf">More...</a><br /></td></tr>
<tr class="separator:ab2e5544e69816fead5d69bedddf46aaf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a347d0c5db9d44f358464d94f6a12f1fd"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a347d0c5db9d44f358464d94f6a12f1fd"></a>
struct <a class="el" href="structco__socket__t.html">co_socket_t</a>&#160;</td><td class="memItemRight" valign="bottom"><b>__attribute__</b> ((packed))</td></tr>
<tr class="separator:a347d0c5db9d44f358464d94f6a12f1fd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a738c4840824f5086ede6a43cdf55948b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structco__obj__t.html">co_obj_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="socket_8h.html#a738c4840824f5086ede6a43cdf55948b">co_socket_create</a> (size_t size, <a class="el" href="structco__socket__t.html">co_socket_t</a> proto)</td></tr>
<tr class="memdesc:a738c4840824f5086ede6a43cdf55948b"><td class="mdescLeft">&#160;</td><td class="mdescRight">creates a socket from specified values or initializes defaults  <a href="#a738c4840824f5086ede6a43cdf55948b">More...</a><br /></td></tr>
<tr class="separator:a738c4840824f5086ede6a43cdf55948b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a338513b3362d6f356c938997116581c5"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="socket_8h.html#a338513b3362d6f356c938997116581c5">co_socket_init</a> (<a class="el" href="structco__obj__t.html">co_obj_t</a> *self)</td></tr>
<tr class="memdesc:a338513b3362d6f356c938997116581c5"><td class="mdescLeft">&#160;</td><td class="mdescRight">creates a socket from specified values or initializes defaults  <a href="#a338513b3362d6f356c938997116581c5">More...</a><br /></td></tr>
<tr class="separator:a338513b3362d6f356c938997116581c5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adeb9a9ee282032d521b6eb2c43df9798"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="socket_8h.html#adeb9a9ee282032d521b6eb2c43df9798">co_socket_destroy</a> (<a class="el" href="structco__obj__t.html">co_obj_t</a> *self)</td></tr>
<tr class="memdesc:adeb9a9ee282032d521b6eb2c43df9798"><td class="mdescLeft">&#160;</td><td class="mdescRight">closes a socket and removes it from memory  <a href="#adeb9a9ee282032d521b6eb2c43df9798">More...</a><br /></td></tr>
<tr class="separator:adeb9a9ee282032d521b6eb2c43df9798"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6d8c27ff42a5f262188f30581fb64a32"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="socket_8h.html#a6d8c27ff42a5f262188f30581fb64a32">co_socket_hangup</a> (<a class="el" href="structco__obj__t.html">co_obj_t</a> *self, <a class="el" href="structco__obj__t.html">co_obj_t</a> *context)</td></tr>
<tr class="memdesc:a6d8c27ff42a5f262188f30581fb64a32"><td class="mdescLeft">&#160;</td><td class="mdescRight">closes a socket and changes its state information  <a href="#a6d8c27ff42a5f262188f30581fb64a32">More...</a><br /></td></tr>
<tr class="separator:a6d8c27ff42a5f262188f30581fb64a32"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a452b8d1bdef98b6d4a310e58e7bbb0bb"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="socket_8h.html#a452b8d1bdef98b6d4a310e58e7bbb0bb">co_socket_send</a> (<a class="el" href="structco__obj__t.html">co_obj_t</a> *self, char *outgoing, size_t length)</td></tr>
<tr class="memdesc:a452b8d1bdef98b6d4a310e58e7bbb0bb"><td class="mdescLeft">&#160;</td><td class="mdescRight">sends a message on a specified socket  <a href="#a452b8d1bdef98b6d4a310e58e7bbb0bb">More...</a><br /></td></tr>
<tr class="separator:a452b8d1bdef98b6d4a310e58e7bbb0bb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1a350b98373b507f95cdfe51550b7768"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="socket_8h.html#a1a350b98373b507f95cdfe51550b7768">co_socket_receive</a> (<a class="el" href="structco__obj__t.html">co_obj_t</a> *self, <a class="el" href="structco__obj__t.html">co_obj_t</a> *fd, char *incoming, size_t length)</td></tr>
<tr class="memdesc:a1a350b98373b507f95cdfe51550b7768"><td class="mdescLeft">&#160;</td><td class="mdescRight">receives a message on the listening socket  <a href="#a1a350b98373b507f95cdfe51550b7768">More...</a><br /></td></tr>
<tr class="separator:a1a350b98373b507f95cdfe51550b7768"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6383a261bc83bef15da466e517cc9157"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="socket_8h.html#a6383a261bc83bef15da466e517cc9157">co_socket_setopt</a> (<a class="el" href="structco__obj__t.html">co_obj_t</a> *self, int level, int option, void *optval, socklen_t optvallen)</td></tr>
<tr class="memdesc:a6383a261bc83bef15da466e517cc9157"><td class="mdescLeft">&#160;</td><td class="mdescRight">sets custom socket options, if specified by user  <a href="#a6383a261bc83bef15da466e517cc9157">More...</a><br /></td></tr>
<tr class="separator:a6383a261bc83bef15da466e517cc9157"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adabb50b2b42a096f680d288051e923c8"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="socket_8h.html#adabb50b2b42a096f680d288051e923c8">co_socket_getopt</a> (<a class="el" href="structco__obj__t.html">co_obj_t</a> *self, int level, int option, void *optval, socklen_t optvallen)</td></tr>
<tr class="memdesc:adabb50b2b42a096f680d288051e923c8"><td class="mdescLeft">&#160;</td><td class="mdescRight">gets custom socket options specified from the user  <a href="#adabb50b2b42a096f680d288051e923c8">More...</a><br /></td></tr>
<tr class="separator:adabb50b2b42a096f680d288051e923c8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac798aeb0efa68cd90f75bc90ddc31659"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="socket_8h.html#ac798aeb0efa68cd90f75bc90ddc31659">unix_socket_init</a> (<a class="el" href="structco__obj__t.html">co_obj_t</a> *self)</td></tr>
<tr class="memdesc:ac798aeb0efa68cd90f75bc90ddc31659"><td class="mdescLeft">&#160;</td><td class="mdescRight">initializes a unix socket  <a href="#ac798aeb0efa68cd90f75bc90ddc31659">More...</a><br /></td></tr>
<tr class="separator:ac798aeb0efa68cd90f75bc90ddc31659"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a15c517822eff4bb81f3c8f6d4f0b5966"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="socket_8h.html#a15c517822eff4bb81f3c8f6d4f0b5966">unix_socket_bind</a> (<a class="el" href="structco__obj__t.html">co_obj_t</a> *self, const char *endpoint)</td></tr>
<tr class="memdesc:a15c517822eff4bb81f3c8f6d4f0b5966"><td class="mdescLeft">&#160;</td><td class="mdescRight">binds a unix socket to a specified endpoint  <a href="#a15c517822eff4bb81f3c8f6d4f0b5966">More...</a><br /></td></tr>
<tr class="separator:a15c517822eff4bb81f3c8f6d4f0b5966"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7ea982093307ed9341383ba1c6fa6bbf"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="socket_8h.html#a7ea982093307ed9341383ba1c6fa6bbf">unix_socket_connect</a> (<a class="el" href="structco__obj__t.html">co_obj_t</a> *self, const char *endpoint)</td></tr>
<tr class="memdesc:a7ea982093307ed9341383ba1c6fa6bbf"><td class="mdescLeft">&#160;</td><td class="mdescRight">connects a socket to specified endpoint  <a href="#a7ea982093307ed9341383ba1c6fa6bbf">More...</a><br /></td></tr>
<tr class="separator:a7ea982093307ed9341383ba1c6fa6bbf"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ae3670fb124525766af019ea3c40c3e2b"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ae3670fb124525766af019ea3c40c3e2b"></a>
struct <a class="el" href="structco__fd__t.html">co_fd_t</a>&#160;</td><td class="memItemRight" valign="bottom"><b>__attribute__</b></td></tr>
<tr class="separator:ae3670fb124525766af019ea3c40c3e2b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa20afbf3f0a782bb4dea4da22df275a3"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aa20afbf3f0a782bb4dea4da22df275a3"></a>
<a class="el" href="structco__obj__t.html">co_obj_t</a>&#160;</td><td class="memItemRight" valign="bottom"><b>_header</b></td></tr>
<tr class="separator:aa20afbf3f0a782bb4dea4da22df275a3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a05de11e79f277be86c869a1fc6a204bd"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a05de11e79f277be86c869a1fc6a204bd"></a>
uint8_t&#160;</td><td class="memItemRight" valign="bottom"><b>_exttype</b></td></tr>
<tr class="separator:a05de11e79f277be86c869a1fc6a204bd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5ff8177a0b8e2c9f9c18bd0cb34e65f8"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a5ff8177a0b8e2c9f9c18bd0cb34e65f8"></a>
uint8_t&#160;</td><td class="memItemRight" valign="bottom"><b>_len</b></td></tr>
<tr class="separator:a5ff8177a0b8e2c9f9c18bd0cb34e65f8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af98b83cec5342c54027dd92f7357d6e6"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="af98b83cec5342c54027dd92f7357d6e6"></a>
char *&#160;</td><td class="memItemRight" valign="bottom"><b>uri</b></td></tr>
<tr class="separator:af98b83cec5342c54027dd92f7357d6e6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aac3f1ffe0904d1aea1af09db456fbf5b"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aac3f1ffe0904d1aea1af09db456fbf5b"></a>
<a class="el" href="structco__fd__t.html">co_fd_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><b>fd</b></td></tr>
<tr class="separator:aac3f1ffe0904d1aea1af09db456fbf5b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9a34257b6220ecf85b58e030748f4e79"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a9a34257b6220ecf85b58e030748f4e79"></a>
<a class="el" href="structco__obj__t.html">co_obj_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><b>rfd_lst</b></td></tr>
<tr class="separator:a9a34257b6220ecf85b58e030748f4e79"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abd3fc6ec06041d63529bc0644073e043"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="abd3fc6ec06041d63529bc0644073e043"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><b>fd_registered</b></td></tr>
<tr class="separator:abd3fc6ec06041d63529bc0644073e043"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af02e31fc7bb94be55789e5870e07c0e7"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="af02e31fc7bb94be55789e5870e07c0e7"></a>
struct sockaddr *&#160;</td><td class="memItemRight" valign="bottom"><b>local</b></td></tr>
<tr class="separator:af02e31fc7bb94be55789e5870e07c0e7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a038cddfb4ca06f1b6af473798c78cbde"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a038cddfb4ca06f1b6af473798c78cbde"></a>
struct sockaddr *&#160;</td><td class="memItemRight" valign="bottom"><b>remote</b></td></tr>
<tr class="separator:a038cddfb4ca06f1b6af473798c78cbde"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a18d2064ca2da3d8ee1553d1123a9a5dc"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a18d2064ca2da3d8ee1553d1123a9a5dc"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><b>listen</b></td></tr>
<tr class="separator:a18d2064ca2da3d8ee1553d1123a9a5dc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af8e01479525f96d8723018a913438bc0"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="af8e01479525f96d8723018a913438bc0"></a>
int(*&#160;</td><td class="memItemRight" valign="bottom"><b>init</b> )(<a class="el" href="structco__obj__t.html">co_obj_t</a> *self)</td></tr>
<tr class="separator:af8e01479525f96d8723018a913438bc0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac63de6a8dc631920f67ad056789d0c80"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ac63de6a8dc631920f67ad056789d0c80"></a>
int(*&#160;</td><td class="memItemRight" valign="bottom"><b>destroy</b> )(<a class="el" href="structco__obj__t.html">co_obj_t</a> *self)</td></tr>
<tr class="separator:ac63de6a8dc631920f67ad056789d0c80"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a23631a4c26dda46bd903cc6f79c6ec80"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a23631a4c26dda46bd903cc6f79c6ec80"></a>
int(*&#160;</td><td class="memItemRight" valign="bottom"><b>hangup</b> )(<a class="el" href="structco__obj__t.html">co_obj_t</a> *self, <a class="el" href="structco__obj__t.html">co_obj_t</a> *context)</td></tr>
<tr class="separator:a23631a4c26dda46bd903cc6f79c6ec80"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7fb08a57d26bfb14809d3cd9d92451a8"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a7fb08a57d26bfb14809d3cd9d92451a8"></a>
int(*&#160;</td><td class="memItemRight" valign="bottom"><b>bind</b> )(<a class="el" href="structco__obj__t.html">co_obj_t</a> *self, const char *endpoint)</td></tr>
<tr class="separator:a7fb08a57d26bfb14809d3cd9d92451a8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0e66be084b91dd56246acbc63bbf3fca"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a0e66be084b91dd56246acbc63bbf3fca"></a>
int(*&#160;</td><td class="memItemRight" valign="bottom"><b>connect</b> )(<a class="el" href="structco__obj__t.html">co_obj_t</a> *self, const char *endpoint)</td></tr>
<tr class="separator:a0e66be084b91dd56246acbc63bbf3fca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae5fe313bba2b66847f4505e93b103d8f"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ae5fe313bba2b66847f4505e93b103d8f"></a>
int(*&#160;</td><td class="memItemRight" valign="bottom"><b>send</b> )(<a class="el" href="structco__obj__t.html">co_obj_t</a> *self, char *outgoing, size_t length)</td></tr>
<tr class="separator:ae5fe313bba2b66847f4505e93b103d8f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a77ccb51e8a8f183c93463cb4f33799db"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a77ccb51e8a8f183c93463cb4f33799db"></a>
int(*&#160;</td><td class="memItemRight" valign="bottom"><b>receive</b> )(<a class="el" href="structco__obj__t.html">co_obj_t</a> *self, <a class="el" href="structco__obj__t.html">co_obj_t</a> *fd, char *incoming, size_t length)</td></tr>
<tr class="separator:a77ccb51e8a8f183c93463cb4f33799db"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a83c382f642a0d7f0d6cc5e6009768292"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a83c382f642a0d7f0d6cc5e6009768292"></a>
int(*&#160;</td><td class="memItemRight" valign="bottom"><b>setopt</b> )(<a class="el" href="structco__obj__t.html">co_obj_t</a> *self, int level, int option, void *optval, socklen_t optvallen)</td></tr>
<tr class="separator:a83c382f642a0d7f0d6cc5e6009768292"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3a6cb966054a118d9eb59b7cda6436b4"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a3a6cb966054a118d9eb59b7cda6436b4"></a>
int(*&#160;</td><td class="memItemRight" valign="bottom"><b>getopt</b> )(<a class="el" href="structco__obj__t.html">co_obj_t</a> *self, int level, int option, void *optval, socklen_t optvallen)</td></tr>
<tr class="separator:a3a6cb966054a118d9eb59b7cda6436b4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adfd77be42f6b8bed40d3a0b2dec754d8"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="adfd77be42f6b8bed40d3a0b2dec754d8"></a>
int(*&#160;</td><td class="memItemRight" valign="bottom"><b>poll_cb</b> )(<a class="el" href="structco__obj__t.html">co_obj_t</a> *self, <a class="el" href="structco__obj__t.html">co_obj_t</a> *context)</td></tr>
<tr class="separator:adfd77be42f6b8bed40d3a0b2dec754d8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aed4641f0caca9bb95b6f92bea25fb1a9"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aed4641f0caca9bb95b6f92bea25fb1a9"></a>
int(*&#160;</td><td class="memItemRight" valign="bottom"><b>register_cb</b> )(<a class="el" href="structco__obj__t.html">co_obj_t</a> *self, <a class="el" href="structco__obj__t.html">co_obj_t</a> *context)</td></tr>
<tr class="separator:aed4641f0caca9bb95b6f92bea25fb1a9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af75c993f487ae0e5236c4c7d02a24d25"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="af75c993f487ae0e5236c4c7d02a24d25"></a>
unsigned int&#160;</td><td class="memItemRight" valign="bottom"><b>events</b></td></tr>
<tr class="separator:af75c993f487ae0e5236c4c7d02a24d25"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a81fe994626b38cafaa6e62d169ec8a55"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a81fe994626b38cafaa6e62d169ec8a55"></a>
<a class="el" href="structco__socket__t.html">co_socket_t</a>&#160;</td><td class="memItemRight" valign="bottom"><b>proto</b></td></tr>
<tr class="separator:a81fe994626b38cafaa6e62d169ec8a55"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a44196e6a5696d10442c29e639437196e"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a44196e6a5696d10442c29e639437196e"></a>
char *&#160;</td><td class="memItemRight" valign="bottom"><b>path</b></td></tr>
<tr class="separator:a44196e6a5696d10442c29e639437196e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>a simple object-oriented socket wrapper object model inspired by Zed Shaw </p>
<dl class="section author"><dt>Author</dt><dd>Josh King (jheretic), <a href="#" onclick="location.href='mai'+'lto:'+'jki'+'ng'+'@ch'+'am'+'ban'+'a.'+'net'; return false;">jking<span style="display: none;">.nosp@m.</span>@cha<span style="display: none;">.nosp@m.</span>mbana<span style="display: none;">.nosp@m.</span>.net</a> </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ab2e5544e69816fead5d69bedddf46aaf"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structco__obj__t.html">co_obj_t</a>* co_fd_create </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structco__obj__t.html">co_obj_t</a> *&#160;</td>
          <td class="paramname"><em>parent</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fd</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>creates a file descriptor object </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">fd</td><td>file descriptor int </td></tr>
  </table>
  </dd>
</dl>

<p>Referenced by <a class="el" href="serval-dna_8c.html#abdd84be4acf337a90ceac0a33493a41b">_watch()</a>, <a class="el" href="socket_8h.html#a338513b3362d6f356c938997116581c5">co_socket_init()</a>, <a class="el" href="socket_8h.html#a1a350b98373b507f95cdfe51550b7768">co_socket_receive()</a>, and <a class="el" href="socket_8h.html#ac798aeb0efa68cd90f75bc90ddc31659">unix_socket_init()</a>.</p>
<div class="fragment"><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;                                                 {</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  CHECK(IS_SOCK(parent),<span class="stringliteral">&quot;Parent is not a socket.&quot;</span>);</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  <a class="code" href="structco__fd__t.html">co_fd_t</a> *new_fd = h_calloc(1,<span class="keyword">sizeof</span>(<a class="code" href="structco__fd__t.html">co_fd_t</a>));</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  new_fd-&gt;_header._type = _ext8;</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  new_fd-&gt;_exttype = _fd;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  new_fd-&gt;_len = <span class="keyword">sizeof</span>(<a class="code" href="structco__fd__t.html">co_fd_t</a>);</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  new_fd-&gt;socket = (<a class="code" href="structco__socket__t.html">co_socket_t</a>*)parent;</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  new_fd-&gt;fd = fd;</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  <span class="keywordflow">return</span> (<a class="code" href="structco__obj__t.html">co_obj_t</a>*)new_fd;</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;error:</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  <span class="keywordflow">return</span> NULL;</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;}</div>
<div class="ttc" id="structco__obj__t_html"><div class="ttname"><a href="structco__obj__t.html">co_obj_t</a></div><div class="ttdef"><b>Definition:</b> obj.h:131</div></div>
<div class="ttc" id="structco__socket__t_html"><div class="ttname"><a href="structco__socket__t.html">co_socket_t</a></div><div class="ttdef"><b>Definition:</b> socket.h:65</div></div>
<div class="ttc" id="structco__fd__t_html"><div class="ttname"><a href="structco__fd__t.html">co_fd_t</a></div><div class="ttdef"><b>Definition:</b> socket.h:48</div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a738c4840824f5086ede6a43cdf55948b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structco__obj__t.html">co_obj_t</a>* co_socket_create </td>
          <td>(</td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structco__socket__t.html">co_socket_t</a>&#160;</td>
          <td class="paramname"><em>proto</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>creates a socket from specified values or initializes defaults </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">size</td><td>size of socket struct </td></tr>
    <tr><td class="paramname">proto</td><td>socket protocol </td></tr>
  </table>
  </dd>
</dl>

<p>References <a class="el" href="socket_8c.html#adeb9a9ee282032d521b6eb2c43df9798">co_socket_destroy()</a>, <a class="el" href="socket_8c.html#adabb50b2b42a096f680d288051e923c8">co_socket_getopt()</a>, <a class="el" href="socket_8c.html#a6d8c27ff42a5f262188f30581fb64a32">co_socket_hangup()</a>, <a class="el" href="socket_8c.html#a1a350b98373b507f95cdfe51550b7768">co_socket_receive()</a>, <a class="el" href="socket_8c.html#a452b8d1bdef98b6d4a310e58e7bbb0bb">co_socket_send()</a>, and <a class="el" href="socket_8c.html#a6383a261bc83bef15da466e517cc9157">co_socket_setopt()</a>.</p>
<div class="fragment"><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;                                                           {</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  <span class="keywordflow">if</span>(!proto.init) proto.init = NULL;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  <span class="keywordflow">if</span>(!proto.destroy) proto.destroy = <a class="code" href="socket_8c.html#adeb9a9ee282032d521b6eb2c43df9798">co_socket_destroy</a>;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  <span class="keywordflow">if</span>(!proto.hangup) proto.hangup = <a class="code" href="socket_8c.html#a6d8c27ff42a5f262188f30581fb64a32">co_socket_hangup</a>;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  <span class="keywordflow">if</span>(!proto.bind) proto.bind = NULL;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  <span class="keywordflow">if</span>(!proto.connect) proto.connect = NULL;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  <span class="keywordflow">if</span>(!proto.send) proto.send = <a class="code" href="socket_8c.html#a452b8d1bdef98b6d4a310e58e7bbb0bb">co_socket_send</a>;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  <span class="keywordflow">if</span>(!proto.receive) proto.receive = <a class="code" href="socket_8c.html#a1a350b98373b507f95cdfe51550b7768">co_socket_receive</a>;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;  <span class="keywordflow">if</span>(!proto.setopt) proto.setopt = <a class="code" href="socket_8c.html#a6383a261bc83bef15da466e517cc9157">co_socket_setopt</a>;</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;  <span class="keywordflow">if</span>(!proto.getopt) proto.getopt = <a class="code" href="socket_8c.html#adabb50b2b42a096f680d288051e923c8">co_socket_getopt</a>;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  <a class="code" href="structco__socket__t.html">co_socket_t</a> *new_sock = h_calloc(1,size);</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  *new_sock = proto;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  new_sock-&gt;_header._type = _ext8;</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  new_sock-&gt;_exttype = _sock;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  new_sock-&gt;_len = size;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  </div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  <span class="keywordflow">if</span>((proto.init != NULL) &amp;&amp; (!new_sock-&gt;init((<a class="code" href="structco__obj__t.html">co_obj_t</a>*)new_sock))) {</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    SENTINEL(<span class="stringliteral">&quot;Failed to initialize new socket.&quot;</span>);</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <span class="keywordflow">return</span> (<a class="code" href="structco__obj__t.html">co_obj_t</a>*)new_sock;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  }</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;error:</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  new_sock-&gt;destroy((<a class="code" href="structco__obj__t.html">co_obj_t</a>*)new_sock);</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  <span class="keywordflow">return</span> NULL;</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;}</div>
<div class="ttc" id="socket_8c_html_adabb50b2b42a096f680d288051e923c8"><div class="ttname"><a href="socket_8c.html#adabb50b2b42a096f680d288051e923c8">co_socket_getopt</a></div><div class="ttdeci">int co_socket_getopt(co_obj_t *self, int level, int option, void *optval, socklen_t optvallen)</div><div class="ttdoc">gets custom socket options specified from the user </div><div class="ttdef"><b>Definition:</b> socket.c:227</div></div>
<div class="ttc" id="socket_8c_html_a6d8c27ff42a5f262188f30581fb64a32"><div class="ttname"><a href="socket_8c.html#a6d8c27ff42a5f262188f30581fb64a32">co_socket_hangup</a></div><div class="ttdeci">int co_socket_hangup(co_obj_t *self, co_obj_t *context)</div><div class="ttdoc">closes a socket and changes its state information </div><div class="ttdef"><b>Definition:</b> socket.c:128</div></div>
<div class="ttc" id="socket_8c_html_a1a350b98373b507f95cdfe51550b7768"><div class="ttname"><a href="socket_8c.html#a1a350b98373b507f95cdfe51550b7768">co_socket_receive</a></div><div class="ttdeci">int co_socket_receive(co_obj_t *self, co_obj_t *fd, char *incoming, size_t length)</div><div class="ttdoc">receives a message on the listening socket </div><div class="ttdef"><b>Definition:</b> socket.c:173</div></div>
<div class="ttc" id="socket_8c_html_a6383a261bc83bef15da466e517cc9157"><div class="ttname"><a href="socket_8c.html#a6383a261bc83bef15da466e517cc9157">co_socket_setopt</a></div><div class="ttdeci">int co_socket_setopt(co_obj_t *self, int level, int option, void *optval, socklen_t optvallen)</div><div class="ttdoc">sets custom socket options, if specified by user </div><div class="ttdef"><b>Definition:</b> socket.c:210</div></div>
<div class="ttc" id="structco__obj__t_html"><div class="ttname"><a href="structco__obj__t.html">co_obj_t</a></div><div class="ttdef"><b>Definition:</b> obj.h:131</div></div>
<div class="ttc" id="structco__socket__t_html"><div class="ttname"><a href="structco__socket__t.html">co_socket_t</a></div><div class="ttdef"><b>Definition:</b> socket.h:65</div></div>
<div class="ttc" id="socket_8c_html_a452b8d1bdef98b6d4a310e58e7bbb0bb"><div class="ttname"><a href="socket_8c.html#a452b8d1bdef98b6d4a310e58e7bbb0bb">co_socket_send</a></div><div class="ttdeci">int co_socket_send(co_obj_t *self, char *outgoing, size_t length)</div><div class="ttdoc">sends a message on a specified socket </div><div class="ttdef"><b>Definition:</b> socket.c:151</div></div>
<div class="ttc" id="socket_8c_html_adeb9a9ee282032d521b6eb2c43df9798"><div class="ttname"><a href="socket_8c.html#adeb9a9ee282032d521b6eb2c43df9798">co_socket_destroy</a></div><div class="ttdeci">int co_socket_destroy(co_obj_t *self)</div><div class="ttdoc">closes a socket and removes it from memory </div><div class="ttdef"><b>Definition:</b> socket.c:118</div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="adeb9a9ee282032d521b6eb2c43df9798"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int co_socket_destroy </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structco__obj__t.html">co_obj_t</a> *&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>closes a socket and removes it from memory </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">self</td><td>socket name </td></tr>
  </table>
  </dd>
</dl>

<p>References <a class="el" href="list_8c.html#a53067bb4fab9f78bdc6e69381bbccd16">co_list_parse()</a>.</p>

<p>Referenced by <a class="el" href="socket_8h.html#a738c4840824f5086ede6a43cdf55948b">co_socket_create()</a>.</p>
<div class="fragment"><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;                                      {</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  <span class="keywordflow">if</span>(<span class="keyword">self</span> &amp;&amp; IS_SOCK(<span class="keyword">self</span>)) {</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    <a class="code" href="structco__socket__t.html">co_socket_t</a> *<span class="keyword">this</span> = (<a class="code" href="structco__socket__t.html">co_socket_t</a>*)<span class="keyword">self</span>;</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <span class="keywordflow">if</span> (this-&gt;fd-&gt;fd &gt; 0) close(this-&gt;fd-&gt;fd);</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    <a class="code" href="list_8c.html#a53067bb4fab9f78bdc6e69381bbccd16">co_list_parse</a>(this-&gt;rfd_lst,_co_socket_close_fd_i,NULL);</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    co_obj_free(<span class="keyword">self</span>);</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;}</div>
<div class="ttc" id="structco__socket__t_html"><div class="ttname"><a href="structco__socket__t.html">co_socket_t</a></div><div class="ttdef"><b>Definition:</b> socket.h:65</div></div>
<div class="ttc" id="list_8c_html_a53067bb4fab9f78bdc6e69381bbccd16"><div class="ttname"><a href="list_8c.html#a53067bb4fab9f78bdc6e69381bbccd16">co_list_parse</a></div><div class="ttdeci">co_obj_t * co_list_parse(co_obj_t *list, co_iter_t iter, void *context)</div><div class="ttdoc">process list with given iterator function </div><div class="ttdef"><b>Definition:</b> list.c:233</div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="adabb50b2b42a096f680d288051e923c8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int co_socket_getopt </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structco__obj__t.html">co_obj_t</a> *&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>level</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>option</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>optval</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">socklen_t&#160;</td>
          <td class="paramname"><em>optvallen</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>gets custom socket options specified from the user </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">self</td><td>socket name </td></tr>
    <tr><td class="paramname">level</td><td>the networking level to be customized </td></tr>
    <tr><td class="paramname">option</td><td>the option to be changed </td></tr>
    <tr><td class="paramname">optval</td><td>the value for the new option </td></tr>
    <tr><td class="paramname">optvallen</td><td>the length of the value for the new option </td></tr>
  </table>
  </dd>
</dl>

<p>Referenced by <a class="el" href="socket_8h.html#a738c4840824f5086ede6a43cdf55948b">co_socket_create()</a>.</p>
<div class="fragment"><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;                                                                                                {</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;  CHECK(IS_SOCK(<span class="keyword">self</span>),<span class="stringliteral">&quot;Not a socket.&quot;</span>);</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;  <a class="code" href="structco__socket__t.html">co_socket_t</a> *<span class="keyword">this</span> = (<a class="code" href="structco__socket__t.html">co_socket_t</a>*)<span class="keyword">self</span>;</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  <span class="comment">//Check to see if this is a standard socket option, or needs custom handling.</span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;  <span class="keywordflow">if</span>(level &lt;= MAX_IPPROTO) {</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    CHECK(!getsockopt(this-&gt;fd-&gt;fd, level, option, optval, &amp;optvallen), <span class="stringliteral">&quot;Problem setting socket options.&quot;</span>);</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    SENTINEL(<span class="stringliteral">&quot;No custom socket options defined!&quot;</span>);</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;  }</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;  <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;error:</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;  <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;}</div>
<div class="ttc" id="structco__socket__t_html"><div class="ttname"><a href="structco__socket__t.html">co_socket_t</a></div><div class="ttdef"><b>Definition:</b> socket.h:65</div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a6d8c27ff42a5f262188f30581fb64a32"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int co_socket_hangup </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structco__obj__t.html">co_obj_t</a> *&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structco__obj__t.html">co_obj_t</a> *&#160;</td>
          <td class="paramname"><em>context</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>closes a socket and changes its state information </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">self</td><td>socket name </td></tr>
    <tr><td class="paramname">context</td><td><a class="el" href="structco__obj__t.html">co_obj_t</a> context pointer (currently unused) </td></tr>
  </table>
  </dd>
</dl>

<p>References <a class="el" href="list_8c.html#a102c8920e3ec13c06747dc752efd91e7">co_list_contains()</a>, and <a class="el" href="list_8c.html#a80fbd77f231ae88663c5d0bb25bdfd6c">co_list_delete()</a>.</p>

<p>Referenced by <a class="el" href="socket_8h.html#a738c4840824f5086ede6a43cdf55948b">co_socket_create()</a>.</p>
<div class="fragment"><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;                                                        {</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;  CHECK_MEM(<span class="keyword">self</span>);</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;  CHECK(IS_SOCK(<span class="keyword">self</span>),<span class="stringliteral">&quot;Not a socket.&quot;</span>);</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  CHECK(IS_FD(context),<span class="stringliteral">&quot;Not a FD.&quot;</span>);</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;  <a class="code" href="structco__socket__t.html">co_socket_t</a> *<span class="keyword">this</span> = (<a class="code" href="structco__socket__t.html">co_socket_t</a>*)<span class="keyword">self</span>;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  <a class="code" href="structco__fd__t.html">co_fd_t</a> *fd = (<a class="code" href="structco__fd__t.html">co_fd_t</a>*)context;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  CHECK(fd-&gt;socket == <span class="keyword">this</span>,<span class="stringliteral">&quot;FD does not match socket&quot;</span>);</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;  <span class="keywordflow">if</span> (fd == this-&gt;fd) {</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    CHECK(close(fd-&gt;fd) != -1,<span class="stringliteral">&quot;Failed to close socket.&quot;</span>);</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    this-&gt;fd_registered = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    this-&gt;listen = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    CHECK(<a class="code" href="list_8c.html#a102c8920e3ec13c06747dc752efd91e7">co_list_contains</a>(this-&gt;rfd_lst,(<a class="code" href="structco__obj__t.html">co_obj_t</a>*)fd),<span class="stringliteral">&quot;Socket does not contain FD&quot;</span>);</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    fd = (<a class="code" href="structco__fd__t.html">co_fd_t</a>*)<a class="code" href="list_8c.html#a80fbd77f231ae88663c5d0bb25bdfd6c">co_list_delete</a>(this-&gt;rfd_lst,(<a class="code" href="structco__obj__t.html">co_obj_t</a>*)fd);</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    CHECK(close(fd-&gt;fd) != -1,<span class="stringliteral">&quot;Failed to close socket.&quot;</span>);</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    co_obj_free((<a class="code" href="structco__obj__t.html">co_obj_t</a>*)fd);</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  }</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;error:</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;  ERROR(<span class="stringliteral">&quot;Failed to hangup any file descriptors for this socket.&quot;</span>);</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;}</div>
<div class="ttc" id="list_8c_html_a80fbd77f231ae88663c5d0bb25bdfd6c"><div class="ttname"><a href="list_8c.html#a80fbd77f231ae88663c5d0bb25bdfd6c">co_list_delete</a></div><div class="ttdeci">co_obj_t * co_list_delete(co_obj_t *list, co_obj_t *item)</div><div class="ttdoc">delete specified item from list </div><div class="ttdef"><b>Definition:</b> list.c:457</div></div>
<div class="ttc" id="structco__obj__t_html"><div class="ttname"><a href="structco__obj__t.html">co_obj_t</a></div><div class="ttdef"><b>Definition:</b> obj.h:131</div></div>
<div class="ttc" id="structco__socket__t_html"><div class="ttname"><a href="structco__socket__t.html">co_socket_t</a></div><div class="ttdef"><b>Definition:</b> socket.h:65</div></div>
<div class="ttc" id="list_8c_html_a102c8920e3ec13c06747dc752efd91e7"><div class="ttname"><a href="list_8c.html#a102c8920e3ec13c06747dc752efd91e7">co_list_contains</a></div><div class="ttdeci">int co_list_contains(co_obj_t *list, co_obj_t *item)</div><div class="ttdoc">determine if list contains specified item </div><div class="ttdef"><b>Definition:</b> list.c:258</div></div>
<div class="ttc" id="structco__fd__t_html"><div class="ttname"><a href="structco__fd__t.html">co_fd_t</a></div><div class="ttdef"><b>Definition:</b> socket.h:48</div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a338513b3362d6f356c938997116581c5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int co_socket_init </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structco__obj__t.html">co_obj_t</a> *&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>creates a socket from specified values or initializes defaults </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">size</td><td>size of socket struct </td></tr>
    <tr><td class="paramname">proto</td><td>socket protocol </td></tr>
  </table>
  </dd>
</dl>

<p>References <a class="el" href="socket_8c.html#ab2e5544e69816fead5d69bedddf46aaf">co_fd_create()</a>.</p>
<div class="fragment"><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;                                   {</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  <span class="keywordflow">if</span>(<span class="keyword">self</span> &amp;&amp; IS_SOCK(<span class="keyword">self</span>)) {</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <a class="code" href="structco__socket__t.html">co_socket_t</a> *<span class="keyword">this</span> = (<a class="code" href="structco__socket__t.html">co_socket_t</a>*)<span class="keyword">self</span>;</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    this-&gt;local = h_calloc(1,<span class="keyword">sizeof</span>(<span class="keyword">struct</span> sockaddr_storage));</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    hattach(this-&gt;local,<span class="keyword">this</span>);</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    this-&gt;remote = h_calloc(1,<span class="keyword">sizeof</span>(<span class="keyword">struct</span> sockaddr_storage));</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    hattach(this-&gt;remote,<span class="keyword">this</span>);</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    this-&gt;fd = (<a class="code" href="structco__fd__t.html">co_fd_t</a>*)<a class="code" href="socket_8c.html#ab2e5544e69816fead5d69bedddf46aaf">co_fd_create</a>((<a class="code" href="structco__obj__t.html">co_obj_t</a>*)<span class="keyword">this</span>,-1);</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    hattach(this-&gt;fd,<span class="keyword">this</span>);</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    this-&gt;rfd_lst = co_list16_create();</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    hattach(this-&gt;rfd_lst,<span class="keyword">this</span>);</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    this-&gt;fd_registered = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    this-&gt;listen = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    this-&gt;events = 0;</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;}</div>
<div class="ttc" id="structco__obj__t_html"><div class="ttname"><a href="structco__obj__t.html">co_obj_t</a></div><div class="ttdef"><b>Definition:</b> obj.h:131</div></div>
<div class="ttc" id="structco__socket__t_html"><div class="ttname"><a href="structco__socket__t.html">co_socket_t</a></div><div class="ttdef"><b>Definition:</b> socket.h:65</div></div>
<div class="ttc" id="structco__fd__t_html"><div class="ttname"><a href="structco__fd__t.html">co_fd_t</a></div><div class="ttdef"><b>Definition:</b> socket.h:48</div></div>
<div class="ttc" id="socket_8c_html_ab2e5544e69816fead5d69bedddf46aaf"><div class="ttname"><a href="socket_8c.html#ab2e5544e69816fead5d69bedddf46aaf">co_fd_create</a></div><div class="ttdeci">co_obj_t * co_fd_create(co_obj_t *parent, int fd)</div><div class="ttdoc">creates a file descriptor object </div><div class="ttdef"><b>Definition:</b> socket.c:47</div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a1a350b98373b507f95cdfe51550b7768"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int co_socket_receive </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structco__obj__t.html">co_obj_t</a> *&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structco__obj__t.html">co_obj_t</a> *&#160;</td>
          <td class="paramname"><em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>incoming</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>length</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>receives a message on the listening socket </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">self</td><td>socket name </td></tr>
    <tr><td class="paramname">incoming</td><td>message received </td></tr>
    <tr><td class="paramname">length</td><td>length of message </td></tr>
  </table>
  </dd>
</dl>

<p>References <a class="el" href="socket_8c.html#ab2e5544e69816fead5d69bedddf46aaf">co_fd_create()</a>, and <a class="el" href="list_8c.html#ada7536773e05cf3dcb33ab73ac2ef84e">co_list_append()</a>.</p>

<p>Referenced by <a class="el" href="socket_8h.html#a738c4840824f5086ede6a43cdf55948b">co_socket_create()</a>.</p>
<div class="fragment"><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;                                                                                   {</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  CHECK_MEM(<span class="keyword">self</span>);</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  CHECK(IS_SOCK(<span class="keyword">self</span>),<span class="stringliteral">&quot;Not a socket.&quot;</span>);</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;  <a class="code" href="structco__socket__t.html">co_socket_t</a> *<span class="keyword">this</span> = (<a class="code" href="structco__socket__t.html">co_socket_t</a>*)<span class="keyword">self</span>;</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;  CHECK(((<a class="code" href="structco__fd__t.html">co_fd_t</a>*)fd)-&gt;socket == <span class="keyword">this</span>,<span class="stringliteral">&quot;FD does not match socket&quot;</span>);</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  <span class="keywordtype">int</span> received = 0;</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  <span class="keywordtype">int</span> rfd = 0;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;  <span class="keywordflow">if</span>(this-&gt;listen) {</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    DEBUG(<span class="stringliteral">&quot;Receiving on listening socket.&quot;</span>);</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    <span class="keywordflow">if</span>((<a class="code" href="structco__fd__t.html">co_fd_t</a>*)fd == this-&gt;fd) {</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;      socklen_t size = <span class="keyword">sizeof</span>(*(this-&gt;remote));</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;      DEBUG(<span class="stringliteral">&quot;Accepting connection (fd=%d).&quot;</span>, this-&gt;fd-&gt;fd);</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;      CHECK((rfd = accept(this-&gt;fd-&gt;fd, (<span class="keyword">struct</span> sockaddr *) this-&gt;remote, &amp;size)) != -1, <span class="stringliteral">&quot;Failed to accept connection.&quot;</span>);</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;      DEBUG(<span class="stringliteral">&quot;Accepted connection (fd=%d).&quot;</span>, rfd);</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;      <a class="code" href="structco__obj__t.html">co_obj_t</a> *new_rfd = <a class="code" href="socket_8c.html#ab2e5544e69816fead5d69bedddf46aaf">co_fd_create</a>((<a class="code" href="structco__obj__t.html">co_obj_t</a>*)<span class="keyword">this</span>,rfd);</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;      CHECK(<a class="code" href="list_8c.html#ada7536773e05cf3dcb33ab73ac2ef84e">co_list_append</a>(this-&gt;rfd_lst,new_rfd),<span class="stringliteral">&quot;Failed to append rfd&quot;</span>);</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;      <span class="keywordtype">int</span> flags = fcntl(rfd, F_GETFL, 0);</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;      fcntl(rfd, F_SETFL, flags | O_NONBLOCK); <span class="comment">//Set non-blocking.</span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;      <span class="keywordflow">if</span>(this-&gt;register_cb) this-&gt;register_cb((<a class="code" href="structco__obj__t.html">co_obj_t</a>*)<span class="keyword">this</span>, new_rfd);</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;      <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;      rfd = ((<a class="code" href="structco__fd__t.html">co_fd_t</a>*)fd)-&gt;fd;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;      DEBUG(<span class="stringliteral">&quot;Setting receiving file descriptor %d.&quot;</span>, rfd);</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    }</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(this-&gt;fd-&gt;fd &gt;= 0) {</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    DEBUG(<span class="stringliteral">&quot;Setting listening file descriptor %d.&quot;</span>, this-&gt;fd-&gt;fd);</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    rfd = this-&gt;fd-&gt;fd;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;  } <span class="keywordflow">else</span> ERROR(<span class="stringliteral">&quot;No valid file descriptor found in socket!&quot;</span>); </div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;  DEBUG(<span class="stringliteral">&quot;Attempting to receive data on FD %d.&quot;</span>, rfd);</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;  CHECK((received = recv(rfd, incoming, length, 0)) &gt;= 0, <span class="stringliteral">&quot;Error receiving data from socket.&quot;</span>);</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;  <span class="keywordflow">return</span> received;</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;error:</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;}</div>
<div class="ttc" id="list_8c_html_ada7536773e05cf3dcb33ab73ac2ef84e"><div class="ttname"><a href="list_8c.html#ada7536773e05cf3dcb33ab73ac2ef84e">co_list_append</a></div><div class="ttdeci">int co_list_append(co_obj_t *list, co_obj_t *new_obj)</div><div class="ttdoc">insert new item at end of list </div><div class="ttdef"><b>Definition:</b> list.c:425</div></div>
<div class="ttc" id="structco__obj__t_html"><div class="ttname"><a href="structco__obj__t.html">co_obj_t</a></div><div class="ttdef"><b>Definition:</b> obj.h:131</div></div>
<div class="ttc" id="structco__socket__t_html"><div class="ttname"><a href="structco__socket__t.html">co_socket_t</a></div><div class="ttdef"><b>Definition:</b> socket.h:65</div></div>
<div class="ttc" id="structco__fd__t_html"><div class="ttname"><a href="structco__fd__t.html">co_fd_t</a></div><div class="ttdef"><b>Definition:</b> socket.h:48</div></div>
<div class="ttc" id="socket_8c_html_ab2e5544e69816fead5d69bedddf46aaf"><div class="ttname"><a href="socket_8c.html#ab2e5544e69816fead5d69bedddf46aaf">co_fd_create</a></div><div class="ttdeci">co_obj_t * co_fd_create(co_obj_t *parent, int fd)</div><div class="ttdoc">creates a file descriptor object </div><div class="ttdef"><b>Definition:</b> socket.c:47</div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a452b8d1bdef98b6d4a310e58e7bbb0bb"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int co_socket_send </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structco__obj__t.html">co_obj_t</a> *&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>outgoing</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>length</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>sends a message on a specified socket </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">self</td><td>socket name </td></tr>
    <tr><td class="paramname">outgoing</td><td>message to be sent </td></tr>
    <tr><td class="paramname">length</td><td>length of message </td></tr>
  </table>
  </dd>
</dl>

<p>Referenced by <a class="el" href="socket_8h.html#a738c4840824f5086ede6a43cdf55948b">co_socket_create()</a>.</p>
<div class="fragment"><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;                                                                  {</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  CHECK_MEM(<span class="keyword">self</span>);</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  CHECK(IS_FD(<span class="keyword">self</span>),<span class="stringliteral">&quot;Not a FD.&quot;</span>);</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;  <a class="code" href="structco__fd__t.html">co_fd_t</a> *<span class="keyword">this</span> = (<a class="code" href="structco__fd__t.html">co_fd_t</a>*)<span class="keyword">self</span>;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> sent = 0;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> remaining = length;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  <span class="keywordtype">int</span> n;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;  <span class="keywordflow">while</span>(sent &lt; length) {</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    n = send(this-&gt;fd, outgoing+sent, remaining, 0);</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <span class="keywordflow">if</span>(n &lt; 0) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    sent += n;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    remaining -= n;</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;  }</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  DEBUG(<span class="stringliteral">&quot;Sent %d bytes.&quot;</span>, sent);</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  <span class="keywordflow">return</span> sent;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;error:</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;  <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;}</div>
<div class="ttc" id="structco__fd__t_html"><div class="ttname"><a href="structco__fd__t.html">co_fd_t</a></div><div class="ttdef"><b>Definition:</b> socket.h:48</div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a6383a261bc83bef15da466e517cc9157"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int co_socket_setopt </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structco__obj__t.html">co_obj_t</a> *&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>level</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>option</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>optval</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">socklen_t&#160;</td>
          <td class="paramname"><em>optvallen</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>sets custom socket options, if specified by user </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">self</td><td>socket name </td></tr>
    <tr><td class="paramname">level</td><td>the networking level to be customized </td></tr>
    <tr><td class="paramname">option</td><td>the option to be changed </td></tr>
    <tr><td class="paramname">optval</td><td>the value for the new option </td></tr>
    <tr><td class="paramname">optvallen</td><td>the length of the value for the new option </td></tr>
  </table>
  </dd>
</dl>

<p>Referenced by <a class="el" href="socket_8h.html#a738c4840824f5086ede6a43cdf55948b">co_socket_create()</a>.</p>
<div class="fragment"><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;                                                                                                {</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;  CHECK(IS_SOCK(<span class="keyword">self</span>),<span class="stringliteral">&quot;Not a socket.&quot;</span>);</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;  <a class="code" href="structco__socket__t.html">co_socket_t</a> *<span class="keyword">this</span> = (<a class="code" href="structco__socket__t.html">co_socket_t</a>*)<span class="keyword">self</span>;</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;  <span class="comment">//Check to see if this is a standard socket option, or needs custom handling.</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;  <span class="keywordflow">if</span>(level &lt;= MAX_IPPROTO) {</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    CHECK(!setsockopt(this-&gt;fd-&gt;fd, level, option, optval, optvallen), <span class="stringliteral">&quot;Problem setting socket options.&quot;</span>);</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    SENTINEL(<span class="stringliteral">&quot;No custom socket options defined!&quot;</span>);</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  }</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;  <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;error:</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;  <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;}</div>
<div class="ttc" id="structco__socket__t_html"><div class="ttname"><a href="structco__socket__t.html">co_socket_t</a></div><div class="ttdef"><b>Definition:</b> socket.h:65</div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a15c517822eff4bb81f3c8f6d4f0b5966"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int unix_socket_bind </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structco__obj__t.html">co_obj_t</a> *&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>endpoint</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>binds a unix socket to a specified endpoint </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">self</td><td>socket name </td></tr>
    <tr><td class="paramname">endpoint</td><td>specified endpoint for socket (file path) </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;                                                           {</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;  DEBUG(<span class="stringliteral">&quot;Binding unix_socket %s.&quot;</span>, endpoint);</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;  CHECK(IS_SOCK(<span class="keyword">self</span>),<span class="stringliteral">&quot;Not a socket.&quot;</span>);</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  <a class="code" href="structunix__socket__t.html">unix_socket_t</a> *<span class="keyword">this</span> = (<a class="code" href="structunix__socket__t.html">unix_socket_t</a>*)<span class="keyword">self</span>;</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  <span class="keyword">struct </span>sockaddr_un *address = (<span class="keyword">struct </span>sockaddr_un *)this-&gt;_(local);</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  CHECK_MEM(address);</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  address-&gt;sun_family = AF_UNIX;</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;  CHECK((<span class="keyword">sizeof</span>(endpoint) &lt;= <span class="keyword">sizeof</span>(address-&gt;sun_path)), <span class="stringliteral">&quot;Endpoint %s is too large for socket path.&quot;</span>, endpoint);</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;  strcpy(address-&gt;sun_path, endpoint);</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;  unlink(address-&gt;sun_path);</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;  <span class="comment">//Initialize socket.</span></div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;  CHECK((this-&gt;_(fd)-&gt;fd = socket(AF_UNIX, SOCK_STREAM, 0)) != -1, <span class="stringliteral">&quot;Failed to grab Unix socket file descriptor.&quot;</span>);</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  <span class="comment">//Set some default socket options.</span></div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> optval = 1;</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;  setsockopt(this-&gt;_(fd)-&gt;fd, SOL_SOCKET, SO_REUSEADDR, &amp;optval, <span class="keyword">sizeof</span>(optval));</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;  <span class="comment">//int flags = fcntl(this-&gt;_(fd)-&gt;fd, F_GETFL, 0);</span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  <span class="comment">//fcntl(this-&gt;_(fd)-&gt;fd, F_SETFL, flags | O_NONBLOCK); //Set non-blocking.</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  <span class="comment">//Set default timeout</span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;  <span class="keyword">struct </span>timeval timeout;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  timeout.tv_sec = 5;</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  timeout.tv_usec = 0;</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;  setsockopt(this-&gt;_(fd)-&gt;fd, SOL_SOCKET, SO_RCVTIMEO, (<span class="keywordtype">char</span> *)&amp;timeout, <span class="keyword">sizeof</span>(timeout));</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;  setsockopt(this-&gt;_(fd)-&gt;fd, SOL_SOCKET, SO_SNDTIMEO, (<span class="keywordtype">char</span> *)&amp;timeout, <span class="keyword">sizeof</span>(timeout));</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;  <span class="comment">//Bind socket to file descriptor.</span></div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;  socklen_t size = offsetof(<span class="keyword">struct</span> sockaddr_un, sun_path) + <span class="keyword">sizeof</span>(address-&gt;sun_path);</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  CHECK(!bind(this-&gt;_(fd)-&gt;fd, (<span class="keyword">struct</span> sockaddr *) address, size), <span class="stringliteral">&quot;Failed to bind Unix socket %s.&quot;</span>, address-&gt;sun_path);</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;  CHECK(!listen(this-&gt;_(fd)-&gt;fd, SOMAXCONN), <span class="stringliteral">&quot;Failed to listen on Unix socket %s.&quot;</span>, address-&gt;sun_path);</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;  this-&gt;_(listen) = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;  <span class="keywordflow">if</span>(this-&gt;_(register_cb)) this-&gt;_(register_cb)((<a class="code" href="structco__obj__t.html">co_obj_t</a>*)<span class="keyword">this</span>, (<a class="code" href="structco__obj__t.html">co_obj_t</a>*)this-&gt;_(fd));</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;  <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;error:</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;  close(this-&gt;_(fd)-&gt;fd);</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;  <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;}</div>
<div class="ttc" id="structco__obj__t_html"><div class="ttname"><a href="structco__obj__t.html">co_obj_t</a></div><div class="ttdef"><b>Definition:</b> obj.h:131</div></div>
<div class="ttc" id="structunix__socket__t_html"><div class="ttname"><a href="structunix__socket__t.html">unix_socket_t</a></div><div class="ttdef"><b>Definition:</b> socket.h:158</div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a7ea982093307ed9341383ba1c6fa6bbf"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int unix_socket_connect </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structco__obj__t.html">co_obj_t</a> *&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>endpoint</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>connects a socket to specified endpoint </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">self</td><td>socket name </td></tr>
    <tr><td class="paramname">endpoint</td><td>specified endpoint for socket (file path) </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;                                                              {</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;  DEBUG(<span class="stringliteral">&quot;Connecting unix_socket %s.&quot;</span>, endpoint);</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;  CHECK(IS_SOCK(<span class="keyword">self</span>),<span class="stringliteral">&quot;Not a socket.&quot;</span>);</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;  <a class="code" href="structunix__socket__t.html">unix_socket_t</a> *<span class="keyword">this</span> = (<a class="code" href="structunix__socket__t.html">unix_socket_t</a>*)<span class="keyword">self</span>;</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;  <span class="keyword">struct </span>sockaddr_un address = { .sun_family = AF_UNIX };</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;  FILE *f = NULL;</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;  CHECK((<span class="keyword">sizeof</span>(endpoint) &lt;= <span class="keyword">sizeof</span>(address.sun_path)), <span class="stringliteral">&quot;Endpoint %s is too large for socket path.&quot;</span>, endpoint);</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;  CHECK(!(f = fopen(endpoint, <span class="stringliteral">&quot;r&quot;</span>)), <span class="stringliteral">&quot;Invalid socket file path.&quot;</span>);</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;  strcpy(address.sun_path, endpoint);</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;  <span class="comment">//Initialize socket.</span></div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;  CHECK((this-&gt;_(fd)-&gt;fd = socket(AF_UNIX, SOCK_STREAM, 0)) != -1, <span class="stringliteral">&quot;Failed to grab Unix socket file descriptor.&quot;</span>);</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;  <span class="comment">//Set some default socket options.</span></div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> optval = 1;</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;  setsockopt(this-&gt;_(fd)-&gt;fd, SOL_SOCKET, SO_REUSEADDR, &amp;optval, <span class="keyword">sizeof</span>(optval));</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;  <span class="comment">//Set default timeout</span></div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;  <span class="keyword">struct </span>timeval timeout;</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;  timeout.tv_sec = 5;</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;  timeout.tv_usec = 0;</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;  setsockopt(this-&gt;_(fd)-&gt;fd, SOL_SOCKET, SO_RCVTIMEO, (<span class="keywordtype">char</span> *)&amp;timeout, <span class="keyword">sizeof</span>(timeout));</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;  setsockopt(this-&gt;_(fd)-&gt;fd, SOL_SOCKET, SO_SNDTIMEO, (<span class="keywordtype">char</span> *)&amp;timeout, <span class="keyword">sizeof</span>(timeout));</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;  <span class="comment">//int flags = fcntl(this-&gt;_(fd)-&gt;fd, F_GETFL, 0);</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;  <span class="comment">//fcntl(this-&gt;_(fd)-&gt;fd, F_SETFL, flags | O_NONBLOCK); //Set non-blocking.</span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;  <span class="comment">//Bind socket to file descriptor.</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;  CHECK(!connect(this-&gt;_(fd)-&gt;fd, (<span class="keyword">struct</span> sockaddr *) &amp;address, <span class="keyword">sizeof</span>(address)) || errno == EINPROGRESS, <span class="stringliteral">&quot;Failed to bind Unix socket.&quot;</span>);</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;  <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;error:</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;  close(this-&gt;_(fd)-&gt;fd);</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;  <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;}</div>
<div class="ttc" id="structunix__socket__t_html"><div class="ttname"><a href="structunix__socket__t.html">unix_socket_t</a></div><div class="ttdef"><b>Definition:</b> socket.h:158</div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ac798aeb0efa68cd90f75bc90ddc31659"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int unix_socket_init </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structco__obj__t.html">co_obj_t</a> *&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>initializes a unix socket </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">self</td><td>socket name </td></tr>
  </table>
  </dd>
</dl>

<p>References <a class="el" href="socket_8c.html#ab2e5544e69816fead5d69bedddf46aaf">co_fd_create()</a>.</p>
<div class="fragment"><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;                                     {</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;  <span class="keywordflow">if</span>(<span class="keyword">self</span> &amp;&amp; IS_SOCK(<span class="keyword">self</span>)) {</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    <a class="code" href="structco__socket__t.html">co_socket_t</a> *<span class="keyword">this</span> = (<a class="code" href="structco__socket__t.html">co_socket_t</a>*)<span class="keyword">self</span>;</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    this-&gt;fd = (<a class="code" href="structco__fd__t.html">co_fd_t</a>*)<a class="code" href="socket_8c.html#ab2e5544e69816fead5d69bedddf46aaf">co_fd_create</a>((<a class="code" href="structco__obj__t.html">co_obj_t</a>*)<span class="keyword">this</span>,-1);</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    hattach(this-&gt;fd,<span class="keyword">this</span>);</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    this-&gt;rfd_lst = co_list16_create();</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    hattach(this-&gt;rfd_lst,<span class="keyword">this</span>);</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    this-&gt;local = h_calloc(1,<span class="keyword">sizeof</span>(<span class="keyword">struct</span> sockaddr_un));</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    hattach(this-&gt;local,<span class="keyword">this</span>);</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    this-&gt;remote = h_calloc(1,<span class="keyword">sizeof</span>(<span class="keyword">struct</span> sockaddr_un));</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    hattach(this-&gt;remote,<span class="keyword">this</span>);</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    this-&gt;fd_registered = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    this-&gt;listen = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    this-&gt;uri = h_strdup(<span class="stringliteral">&quot;unix://&quot;</span>);</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    hattach(this-&gt;uri,<span class="keyword">this</span>);</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    this-&gt;events = 0;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;}</div>
<div class="ttc" id="structco__obj__t_html"><div class="ttname"><a href="structco__obj__t.html">co_obj_t</a></div><div class="ttdef"><b>Definition:</b> obj.h:131</div></div>
<div class="ttc" id="structco__socket__t_html"><div class="ttname"><a href="structco__socket__t.html">co_socket_t</a></div><div class="ttdef"><b>Definition:</b> socket.h:65</div></div>
<div class="ttc" id="structco__fd__t_html"><div class="ttname"><a href="structco__fd__t.html">co_fd_t</a></div><div class="ttdef"><b>Definition:</b> socket.h:48</div></div>
<div class="ttc" id="socket_8c_html_ab2e5544e69816fead5d69bedddf46aaf"><div class="ttname"><a href="socket_8c.html#ab2e5544e69816fead5d69bedddf46aaf">co_fd_create</a></div><div class="ttdeci">co_obj_t * co_fd_create(co_obj_t *parent, int fd)</div><div class="ttdoc">creates a file descriptor object </div><div class="ttdef"><b>Definition:</b> socket.c:47</div></div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->

<!-- HTML footer for doxygen 1.8.6-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Jun 6 2014 13:22:05 for commotiond by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.7
</small></address>
<script type="text/javascript" src="dynsections.js"></script>
</div>
