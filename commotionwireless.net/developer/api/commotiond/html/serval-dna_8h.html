---
layout: default
title: API Reference - commotiond
site_section: developers
categories: 
created: 2014-06-06 13:22:04.584366
changed: 2014-06-06 13:22:04.584366
post_author: Commotion
lang: en
---
<div id="doxygen">
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part --> 
<!-- Generated by Doxygen 1.8.7 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_38c8d24aef3972a7f87b834274e76e31.html">plugins</a></li><li class="navelem"><a class="el" href="dir_0a9a372aadd43cc6ec1f168ac17a5ec6.html">serval-dna</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">serval-dna.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>re-implementation of the serval-dna daemon as a commotiond plugin  
<a href="#details">More...</a></p>

<p><a href="serval-dna_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ade6bc30b860b7e0c016c9d1d4de78876"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ade6bc30b860b7e0c016c9d1d4de78876"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>DEFAULT_SID</b>&#160;&#160;&#160;&quot;0000000000000000000000000000000000000000000000000000000000000000&quot;</td></tr>
<tr class="separator:ade6bc30b860b7e0c016c9d1d4de78876"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa6eb102f7cb9b4ecc447f497f59aefcc"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aa6eb102f7cb9b4ecc447f497f59aefcc"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>DEFAULT_MDP_PATH</b>&#160;&#160;&#160;&quot;/etc/commotion/keys.d/mdp.keyring/serval.keyring&quot;</td></tr>
<tr class="separator:aa6eb102f7cb9b4ecc447f497f59aefcc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad6d73c9630ed82f7fe50ef5a025caa52"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ad6d73c9630ed82f7fe50ef5a025caa52"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>DEFAULT_SERVAL_PATH</b>&#160;&#160;&#160;&quot;/var/serval-node&quot;</td></tr>
<tr class="separator:ad6d73c9630ed82f7fe50ef5a025caa52"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae688d728e1acdfe5988c7db45d6f0166"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ae688d728e1acdfe5988c7db45d6f0166"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>PATH_MAX</b>&#160;&#160;&#160;4096</td></tr>
<tr class="separator:ae688d728e1acdfe5988c7db45d6f0166"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a10ab198359509a611627a85d8321ac86"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="serval-dna_8h.html#a10ab198359509a611627a85d8321ac86">CHECK_ERR</a>(A, M,...)</td></tr>
<tr class="separator:a10ab198359509a611627a85d8321ac86"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a10ab198359509a611627a85d8321ac86"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="serval-dna_8h.html#a10ab198359509a611627a85d8321ac86">CHECK_ERR</a>(A, M,...)</td></tr>
<tr class="separator:a10ab198359509a611627a85d8321ac86"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad618463c254680a37e278c1e76aeb15d"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ad618463c254680a37e278c1e76aeb15d"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>CLEAR_ERR</b>()&#160;&#160;&#160;err_msg = NULL;</td></tr>
<tr class="separator:ad618463c254680a37e278c1e76aeb15d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeed42e449c7436fab8354659982dc443"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aeed42e449c7436fab8354659982dc443"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>INS_ERROR</b>()&#160;&#160;&#160;if (err_msg) { CMD_OUTPUT(&quot;errors&quot;,err_msg); }</td></tr>
<tr class="separator:aeed42e449c7436fab8354659982dc443"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a3bbb939458a3edc82ae0bfe5602967df"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a3bbb939458a3edc82ae0bfe5602967df"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>co_plugin_register</b> (<a class="el" href="structco__obj__t.html">co_obj_t</a> *self, <a class="el" href="structco__obj__t.html">co_obj_t</a> **output, <a class="el" href="structco__obj__t.html">co_obj_t</a> *params)</td></tr>
<tr class="separator:a3bbb939458a3edc82ae0bfe5602967df"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0eccb03577be7f0f0e22a4d427f8773f"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a0eccb03577be7f0f0e22a4d427f8773f"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>co_plugin_init</b> (<a class="el" href="structco__obj__t.html">co_obj_t</a> *self, <a class="el" href="structco__obj__t.html">co_obj_t</a> **output, <a class="el" href="structco__obj__t.html">co_obj_t</a> *params)</td></tr>
<tr class="separator:a0eccb03577be7f0f0e22a4d427f8773f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab65e09211a66e5e4a54fcb0e963af7fe"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ab65e09211a66e5e4a54fcb0e963af7fe"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>co_plugin_name</b> (<a class="el" href="structco__obj__t.html">co_obj_t</a> *self, <a class="el" href="structco__obj__t.html">co_obj_t</a> **output, <a class="el" href="structco__obj__t.html">co_obj_t</a> *params)</td></tr>
<tr class="separator:ab65e09211a66e5e4a54fcb0e963af7fe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adef3d509f8db4a677d75c4bca5142d8a"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="adef3d509f8db4a677d75c4bca5142d8a"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>co_plugin_shutdown</b> (<a class="el" href="structco__obj__t.html">co_obj_t</a> *self, <a class="el" href="structco__obj__t.html">co_obj_t</a> **output, <a class="el" href="structco__obj__t.html">co_obj_t</a> *params)</td></tr>
<tr class="separator:adef3d509f8db4a677d75c4bca5142d8a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1555be4d16034b506577764fbd2cfb5d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="serval-dna_8h.html#a1555be4d16034b506577764fbd2cfb5d">serval_socket_cb</a> (<a class="el" href="structco__obj__t.html">co_obj_t</a> *self, <a class="el" href="structco__obj__t.html">co_obj_t</a> *context)</td></tr>
<tr class="separator:a1555be4d16034b506577764fbd2cfb5d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a00d4df9eabb0ac594cc118143943392f"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a00d4df9eabb0ac594cc118143943392f"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>serval_timer_cb</b> (<a class="el" href="structco__obj__t.html">co_obj_t</a> *self, <a class="el" href="structco__obj__t.html">co_obj_t</a> **output, <a class="el" href="structco__obj__t.html">co_obj_t</a> *context)</td></tr>
<tr class="separator:a00d4df9eabb0ac594cc118143943392f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0e0920eff3548cf56da6e9f8c5c4e5ab"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a0e0920eff3548cf56da6e9f8c5c4e5ab"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>serval_schema</b> (<a class="el" href="structco__obj__t.html">co_obj_t</a> *self, <a class="el" href="structco__obj__t.html">co_obj_t</a> **output, <a class="el" href="structco__obj__t.html">co_obj_t</a> *params)</td></tr>
<tr class="separator:a0e0920eff3548cf56da6e9f8c5c4e5ab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a31d498ab46d883bda2967eca577b8890"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a31d498ab46d883bda2967eca577b8890"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>serval_daemon_handler</b> (<a class="el" href="structco__obj__t.html">co_obj_t</a> *self, <a class="el" href="structco__obj__t.html">co_obj_t</a> **output, <a class="el" href="structco__obj__t.html">co_obj_t</a> *params)</td></tr>
<tr class="separator:a31d498ab46d883bda2967eca577b8890"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>re-implementation of the serval-dna daemon as a commotiond plugin </p>
<dl class="section author"><dt>Author</dt><dd>Dan Staples (dismantl), <a href="#" onclick="location.href='mai'+'lto:'+'dan'+'st'+'apl'+'es'+'@op'+'en'+'tec'+'hi'+'nst'+'it'+'ute'+'.o'+'rg'; return false;">danst<span style="display: none;">.nosp@m.</span>aple<span style="display: none;">.nosp@m.</span>s@ope<span style="display: none;">.nosp@m.</span>ntec<span style="display: none;">.nosp@m.</span>hinst<span style="display: none;">.nosp@m.</span>itut<span style="display: none;">.nosp@m.</span>e.org</a> </dd></dl>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="a10ab198359509a611627a85d8321ac86"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CHECK_ERR</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">A, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">M, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line"><span class="keywordflow">if</span>(!(A)) { \</div>
<div class="line">    ERROR(M, ##__VA_ARGS__); \</div>
<div class="line">    if (err_msg == NULL) \</div>
<div class="line">      err_msg = co_list16_create(); \</div>
<div class="line">    char *msg = NULL; \</div>
<div class="line">    int len = snprintf(NULL, 0, M, ##__VA_ARGS__); \</div>
<div class="line">    msg = calloc(len + 1,<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>)); \</div>
<div class="line">    sprintf(msg, M, ##__VA_ARGS__); \</div>
<div class="line">    if (len &lt; UINT8_MAX) { <a class="code" href="list_8c.html#ada7536773e05cf3dcb33ab73ac2ef84e">\</a></div>
<div class="line"><a class="code" href="list_8c.html#ada7536773e05cf3dcb33ab73ac2ef84e">      co_list_append</a>(err_msg, co_str8_create(msg,len+1,0)); \</div>
<div class="line">    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (len &lt; UINT16_MAX) { <a class="code" href="list_8c.html#ada7536773e05cf3dcb33ab73ac2ef84e">\</a></div>
<div class="line"><a class="code" href="list_8c.html#ada7536773e05cf3dcb33ab73ac2ef84e">      co_list_append</a>(err_msg, co_str16_create(msg,len+1,0)); \</div>
<div class="line">    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (len &lt; UINT32_MAX) { <a class="code" href="list_8c.html#ada7536773e05cf3dcb33ab73ac2ef84e">\</a></div>
<div class="line"><a class="code" href="list_8c.html#ada7536773e05cf3dcb33ab73ac2ef84e">      co_list_append</a>(err_msg, co_str32_create(msg,len+1,0)); \</div>
<div class="line">    } \</div>
<div class="line">    free(msg); \</div>
<div class="line">    goto error; \</div>
<div class="line">  }</div>
<div class="ttc" id="list_8c_html_ada7536773e05cf3dcb33ab73ac2ef84e"><div class="ttname"><a href="list_8c.html#ada7536773e05cf3dcb33ab73ac2ef84e">co_list_append</a></div><div class="ttdeci">int co_list_append(co_obj_t *list, co_obj_t *new_obj)</div><div class="ttdoc">insert new item at end of list </div><div class="ttdef"><b>Definition:</b> list.c:425</div></div>
</div><!-- fragment --><p>until we have nested tree support </p>

</div>
</div>
<a class="anchor" id="a10ab198359509a611627a85d8321ac86"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CHECK_ERR</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">A, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">M, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line"><span class="keywordflow">if</span>(!(A)) { \</div>
<div class="line">    ERROR(M, ##__VA_ARGS__); \</div>
<div class="line">    if (err_msg) \</div>
<div class="line">      co_obj_free(err_msg); \</div>
<div class="line">    char *msg = NULL; \</div>
<div class="line">    int len = snprintf(NULL, 0, M, ##__VA_ARGS__); \</div>
<div class="line">    msg = calloc(len + 1,<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>)); \</div>
<div class="line">    sprintf(msg, M, ##__VA_ARGS__); \</div>
<div class="line">    if (len &lt; UINT8_MAX) { \</div>
<div class="line">      err_msg = co_str8_create(msg,len+1,0); \</div>
<div class="line">    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (len &lt; UINT16_MAX) { \</div>
<div class="line">      err_msg = co_str16_create(msg,len+1,0); \</div>
<div class="line">    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (len &lt; UINT32_MAX) { \</div>
<div class="line">      err_msg = co_str32_create(msg,len+1,0); \</div>
<div class="line">    } \</div>
<div class="line">    free(msg); \</div>
<div class="line">    goto error; \</div>
<div class="line">  }</div>
</div><!-- fragment --><p>until we have nested tree support </p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a1555be4d16034b506577764fbd2cfb5d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int serval_socket_cb </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structco__obj__t.html">co_obj_t</a> *&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structco__obj__t.html">co_obj_t</a> *&#160;</td>
          <td class="paramname"><em>context</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Callback function for when Serval socket has data to read </p>

<p>References <a class="el" href="list_8c.html#a53067bb4fab9f78bdc6e69381bbccd16">co_list_parse()</a>.</p>

<p>Referenced by <a class="el" href="serval-dna_8c.html#abdd84be4acf337a90ceac0a33493a41b">_watch()</a>.</p>
<div class="fragment"><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;                                                        {</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="comment">//   DEBUG(&quot;SERVAL_SOCKET_CB&quot;);</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  <a class="code" href="structco__socket__t.html">co_socket_t</a> *sock = (<a class="code" href="structco__socket__t.html">co_socket_t</a>*)<span class="keyword">self</span>;</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  <a class="code" href="structco__obj__t.html">co_obj_t</a> *node = NULL;</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;  <span class="keyword">struct </span>sched_ent *alarm = NULL;</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  </div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  <span class="comment">// find alarm associated w/ sock, call alarm-&gt;function(alarm)</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  <span class="keywordflow">if</span> ((node = <a class="code" href="list_8c.html#a53067bb4fab9f78bdc6e69381bbccd16">co_list_parse</a>(sock_alarms, _alarm_fd_match_i, &amp;sock-&gt;fd-&gt;fd))) {</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    alarm = ((<a class="code" href="structco__alarm__t.html">co_alarm_t</a>*)node)-&gt;alarm;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    alarm-&gt;poll.revents = sock-&gt;events;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    </div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    alarm-&gt;function(alarm); <span class="comment">// Serval callback function associated with alarm/socket</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    alarm-&gt;poll.revents = 0;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    </div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;  }</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  </div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;}</div>
<div class="ttc" id="structco__obj__t_html"><div class="ttname"><a href="structco__obj__t.html">co_obj_t</a></div><div class="ttdef"><b>Definition:</b> obj.h:131</div></div>
<div class="ttc" id="structco__socket__t_html"><div class="ttname"><a href="structco__socket__t.html">co_socket_t</a></div><div class="ttdef"><b>Definition:</b> socket.h:65</div></div>
<div class="ttc" id="list_8c_html_a53067bb4fab9f78bdc6e69381bbccd16"><div class="ttname"><a href="list_8c.html#a53067bb4fab9f78bdc6e69381bbccd16">co_list_parse</a></div><div class="ttdeci">co_obj_t * co_list_parse(co_obj_t *list, co_iter_t iter, void *context)</div><div class="ttdoc">process list with given iterator function </div><div class="ttdef"><b>Definition:</b> list.c:233</div></div>
<div class="ttc" id="structco__alarm__t_html"><div class="ttname"><a href="structco__alarm__t.html">co_alarm_t</a></div><div class="ttdef"><b>Definition:</b> serval-dna.c:60</div></div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->

<!-- HTML footer for doxygen 1.8.6-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Jun 6 2014 13:22:05 for commotiond by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.7
</small></address>
<script type="text/javascript" src="dynsections.js"></script>
</div>
